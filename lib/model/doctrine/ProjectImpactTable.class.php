<?php

/**
 * ProjectImpactTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ProjectImpactTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object ProjectImpactTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('ProjectImpact');
    }
	
	static public $impacts = array(
		'level_1' => 'Level 1',
		'level_2' => 'Level 2',
		'level_3' => 'Level 3',
		'reject' => 'Reject'
	);
	
	public function getImpactLevels()
	{
		return self::$impacts;
	}
	
	public function getImpact()
	{
		$userid = sfContext::getInstance()->getUser()->getGuardUser()->getId(); // get the username of the user logged
		$query = Doctrine_Manager::getInstance()->getCurrentConnection()->fetchAssoc("SELECT project_impact.impact_level FROM project_impact LEFT JOIN e_i_application ON e_i_application.id = project_impact.company_id WHERE e_i_application.created_by = '$userid' ");
		
		return $query;
	
	}
	
	public function getImpacts()
	{
		$userid = sfContext::getInstance()->getUser()->getGuardUser()->getId(); // get the username of the user logged
		$q = $this->createQuery('i')
		  ->leftJoin('i.EIApplication e')
		  ->where('e.created_by = ?', $userid);

		return $q->execute();
	}
}