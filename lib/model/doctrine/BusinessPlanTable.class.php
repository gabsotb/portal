<?php

/**
 * BusinessPlanTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class BusinessPlanTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object BusinessPlanTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('BusinessPlan');
    }
	//some static fields
	static public $allowance = array(
    'yes' => 'Yes',
    'no' => 'No',
     );
	 //return static field
	 public function getAllowance()
	 {
	  return self::$allowance;
	 }
	//this method will receive a an id and then query table for the record with the id from this table, if it returns
	//null then, that means the user completed step 1 and failed to complete step 2
	public function getBusinessPlanDetails($investment_id)
	{
	   $query = Doctrine_Manager::getInstance()->getCurrentConnection()->fetchAssoc("
	    SELECT business_plan.investment_id from business_plan 
		LEFT JOIN business_application_status ON  business_plan.investment_id = business_application_status.business_id
		where business_plan.investment_id = '$investment_id' and business_application_status.application_status = 'certificateissued'
	   ");
	   return $query;
	}
	//we select email addresses for users who have rights to assignjobs to data admins and notify them 
	public function getUsers($role)
	{
	   $query = Doctrine_Manager::getInstance()->getCurrentConnection()->fetchAssoc("
	    SELECT sf_guard_user.email_address,sf_guard_user.username
		from sf_guard_user_group left join sf_guard_group on sf_guard_user_group.group_id = sf_guard_group.id
		left join sf_guard_user on sf_guard_user_group.user_id = sf_guard_user.id
		 where sf_guard_group.name = '$role'
	   ");
	   return $query;
	}
	
}